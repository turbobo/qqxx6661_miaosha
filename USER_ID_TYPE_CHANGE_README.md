# ç”¨æˆ·IDç±»å‹ä¿®æ”¹è¯´æ˜

## ğŸ¯ ä¿®æ”¹æ¦‚è¿°

å°†ç³»ç»Ÿä¸­çš„`userId`å­—æ®µç±»å‹ä»`String`ç»Ÿä¸€ä¿®æ”¹ä¸º`Long`ç±»å‹ï¼Œå¹¶è®¾ç½®é»˜è®¤å€¼ä¸º`-1`è¡¨ç¤ºåŒ¿åç”¨æˆ·ã€‚

## ğŸ”§ ä¿®æ”¹å†…å®¹

### 1. å‰ç«¯ä»£ç ä¿®æ”¹

#### `miaosha-web/src/main/resources/index.html`
- **ä¿®æ”¹å‰**: `currentUserId: ''` (ç©ºå­—ç¬¦ä¸²)
- **ä¿®æ”¹å**: `currentUserId: -1` (Longç±»å‹ï¼Œé»˜è®¤-1è¡¨ç¤ºåŒ¿åç”¨æˆ·)
- **æŠ¢è´­è¯·æ±‚**: ç›´æ¥ä½¿ç”¨`this.currentUserId`ï¼Œä¸å†éœ€è¦è½¬æ¢ä¸ºå­—ç¬¦ä¸²

```javascript
// ä¿®æ”¹å‰
userId: 'anonymous', // ä½¿ç”¨åŒ¿åç”¨æˆ·ID

// ä¿®æ”¹å
userId: this.currentUserId, // ä½¿ç”¨-1ä½œä¸ºåŒ¿åç”¨æˆ·ID
```

### 2. åç«¯æ¥å£ä¿®æ”¹

#### `TicketCodeGeneratorService` æ¥å£
- **ä¿®æ”¹å‰**: `String generateUniqueTicketCode(String userId, String date)`
- **ä¿®æ”¹å**: `String generateUniqueTicketCode(Long userId, String date)`

#### `TicketCodeGeneratorServiceImpl` å®ç°ç±»
- æ‰€æœ‰ç›¸å…³æ–¹æ³•çš„`userId`å‚æ•°ç±»å‹ä»`String`æ”¹ä¸º`Long`
- åŒ…æ‹¬ï¼š
  - `generateUniqueTicketCode(Long userId, String date)`
  - `generateTicketCode(Long userId, String date)`
  - `generateTicketCodeWithRedisSequence(Long userId, String date)`
  - `generateTicketCodeWithTimestamp(Long userId, String date)`
  - `generateTicketCodeWithUUID(Long userId, String date)`

#### `TicketServiceImpl` æœåŠ¡ç±»
- è°ƒç”¨`ticketCodeGeneratorService.generateUniqueTicketCode()`æ—¶ï¼Œç›´æ¥ä¼ é€’`userId`å‚æ•°
- **ä¿®æ”¹å‰**: `userId.toString()`
- **ä¿®æ”¹å**: `userId`

### 3. æµ‹è¯•ä»£ç ä¿®æ”¹

#### `TicketCodeGeneratorTest` æµ‹è¯•ç±»
- æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ä¸­çš„`userId`å˜é‡ç±»å‹ä»`String`æ”¹ä¸º`Long`
- æµ‹è¯•æ•°æ®ä»å­—ç¬¦ä¸²æ”¹ä¸ºLongç±»å‹ï¼š
  ```java
  // ä¿®æ”¹å‰
  String userId = "1001";
  
  // ä¿®æ”¹å
  Long userId = 1001L;
  ```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åŒ¿åç”¨æˆ·æ ‡è¯†
- **å¸¸é‡å®šä¹‰**: `User.ANONYMOUS = -1L`
- **é»˜è®¤å€¼**: å‰ç«¯`currentUserId`é»˜è®¤ä¸º`-1`
- **ä¸šåŠ¡é€»è¾‘**: `-1`è¡¨ç¤ºæœªç™»å½•çš„åŒ¿åç”¨æˆ·

### ç±»å‹ä¸€è‡´æ€§
- **æ•°æ®åº“**: `user_id`å­—æ®µç±»å‹ä¸º`BIGINT`
- **Javaå®ä½“**: `userId`å­—æ®µç±»å‹ä¸º`Long`
- **å‰ç«¯**: `currentUserId`ç±»å‹ä¸º`Number`ï¼Œé»˜è®¤å€¼`-1`
- **APIæ¥å£**: æ‰€æœ‰ç›¸å…³æ¥å£çš„`userId`å‚æ•°ç±»å‹ä¸º`Long`

## ğŸ“Š ä¿®æ”¹å‰åå¯¹æ¯”

| ç»„ä»¶ | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|------|--------|--------|
| å‰ç«¯å˜é‡ | `currentUserId: ''` | `currentUserId: -1` |
| å‰ç«¯è¯·æ±‚ | `userId: 'anonymous'` | `userId: this.currentUserId` |
| åç«¯æ¥å£ | `String userId` | `Long userId` |
| åç«¯å®ç° | `userId.toString()` | `userId` |
| æµ‹è¯•æ•°æ® | `"1001"` | `1001L` |
| åŒ¿åæ ‡è¯† | å­—ç¬¦ä¸²`'anonymous'` | æ•°å­—`-1` |

## ğŸš€ ä¼˜åŠ¿

### 1. ç±»å‹å®‰å…¨
- é¿å…å­—ç¬¦ä¸²å’Œæ•°å­—ç±»å‹æ··ç”¨
- ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯

### 2. æ€§èƒ½æå‡
- `Long`ç±»å‹æ¯”è¾ƒæ¯”`String`ç±»å‹æ›´å¿«
- å‡å°‘å­—ç¬¦ä¸²è½¬æ¢å¼€é”€

### 3. æ•°æ®ä¸€è‡´æ€§
- ä¸æ•°æ®åº“å­—æ®µç±»å‹ä¿æŒä¸€è‡´
- é¿å…ç±»å‹è½¬æ¢å¯¼è‡´çš„æ•°æ®ä¸¢å¤±

### 4. ä»£ç æ¸…æ™°
- æ˜ç¡®çš„ç±»å‹å®šä¹‰
- æ›´å¥½çš„ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å‰ç«¯å…¼å®¹æ€§
- ç¡®ä¿å‰ç«¯JavaScriptæ­£ç¡®å¤„ç†æ•°å­—ç±»å‹
- éªŒè¯`-1`å€¼åœ¨ä¸šåŠ¡é€»è¾‘ä¸­çš„å¤„ç†

### 2. æ•°æ®åº“å…¼å®¹æ€§
- ç¡®ä¿æ‰€æœ‰ç›¸å…³è¡¨çš„`user_id`å­—æ®µç±»å‹ä¸º`BIGINT`
- æ£€æŸ¥ç°æœ‰æ•°æ®çš„ç±»å‹å…¼å®¹æ€§

### 3. APIå…¼å®¹æ€§
- ç¡®ä¿æ‰€æœ‰è°ƒç”¨æ–¹éƒ½ä½¿ç”¨Longç±»å‹çš„userId
- æ›´æ–°ç›¸å…³APIæ–‡æ¡£

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. å•å…ƒæµ‹è¯•
- è¿è¡Œ`TicketCodeGeneratorTest`ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
- éªŒè¯Longç±»å‹å‚æ•°çš„æ­£ç¡®å¤„ç†

### 2. é›†æˆæµ‹è¯•
- æµ‹è¯•å‰ç«¯æŠ¢è´­åŠŸèƒ½
- éªŒè¯åŒ¿åç”¨æˆ·ï¼ˆuserId: -1ï¼‰çš„æŠ¢è´­æµç¨‹

### 3. æ•°æ®åº“æµ‹è¯•
- éªŒè¯userIdä¸º-1çš„è®°å½•æ­£ç¡®å­˜å‚¨
- æ£€æŸ¥æ•°æ®ç±»å‹ä¸€è‡´æ€§

## ğŸ“ æ€»ç»“

é€šè¿‡å°†`userId`ç±»å‹ç»Ÿä¸€ä¿®æ”¹ä¸º`Long`ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

1. **ç±»å‹ç»Ÿä¸€**: å‰åç«¯ã€æ•°æ®åº“ç±»å‹ä¿æŒä¸€è‡´
2. **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘ç±»å‹è½¬æ¢ï¼Œæå‡æ€§èƒ½
3. **ä»£ç è´¨é‡**: æ›´æ¸…æ™°çš„ç±»å‹å®šä¹‰ï¼Œæ›´å¥½çš„å¯ç»´æŠ¤æ€§
4. **åŒ¿åç”¨æˆ·**: ä½¿ç”¨`-1`ä½œä¸ºåŒ¿åç”¨æˆ·æ ‡è¯†ï¼Œè¯­ä¹‰æ›´æ¸…æ™°

è¿™æ¬¡ä¿®æ”¹ä¸ºç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§å¥ å®šäº†è‰¯å¥½çš„åŸºç¡€ã€‚ğŸ‰
