<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥ç¥¨æ•°æŠ¢è´­ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        dark: '#1E293B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }

            .card-hover {
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }

            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.1), 0 10px 10px -5px rgba(59, 130, 246, 0.04);
            }

            .pulse {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }

            .star-rotate {
                animation: rotate 8s linear infinite;
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
<div id="app" class="container mx-auto px-4 py-8">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="bg-white shadow-sm sticky top-0 z-50 mb-8">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-ticket text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-dark">ç¥¨åˆ¸æŠ¢è´­ç³»ç»Ÿ V1</h1>
            </div>

            <!-- ç§’æ€æ´»åŠ¨çŠ¶æ€æ˜¾ç¤º -->
            <div v-if="miaoshaStatus.paused"
                 class="flex items-center space-x-2 px-4 py-2 bg-yellow-100 border border-yellow-300 rounded-lg">
                <i class="fa fa-exclamation-triangle text-yellow-600"></i>
                <span class="text-yellow-800 font-medium">ç§’æ€æ´»åŠ¨æ­£åœ¨ç»´æŠ¤ä¸­</span>
            </div>

            <div class="flex items-center space-x-4">
                <!-- æ³¨é‡Šæ‰ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºå’Œç™»å½•ç›¸å…³æŒ‰é’® -->
                <!-- <div v-if="currentUser" class="flex items-center space-x-2 text-gray-600">
                    <i class="fa fa-user-circle-o text-xl"></i>
                    <span>{{ currentUser }}</span>
                </div>
                <div v-if="!currentUser" class="text-gray-500">
                    <span>æœªç™»å½•</span>
                </div>
                <button v-if="currentUser" @click="logout"
                        class="text-gray-500 hover:text-gray-700 transition-colors">
                    <i class="fa fa-sign-out mr-1"></i>
                    é€€å‡ºç™»å½•
                </button>
                <button v-if="!currentUser" @click="goToLogin"
                        class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                    <i class="fa fa-sign-in mr-1"></i>
                    ç™»å½•
                </button> -->

                <!-- æ˜¾ç¤ºåŒ¿åç”¨æˆ·ä¿¡æ¯ -->
                <div class="flex items-center space-x-2 text-gray-600">
                    <i class="fa fa-user-circle-o text-xl"></i>
                    <span>åŒ¿åç”¨æˆ·</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ç®¡ç†åŠŸèƒ½å¯¼èˆª -->
    <div class="bg-white shadow-sm rounded-lg mb-6">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-wrap gap-3 justify-center">
                <a href="admin-ticket-update.html"
                   class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm">
                    <i class="fa fa-edit mr-2"></i>ç¥¨åˆ¸ç®¡ç†
                </a>
                <a href="ticket-validation.html"
                   class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm">
                    <i class="fa fa-check-circle mr-2"></i>ç¥¨æ•°æ£€æŸ¥
                </a>
                <a href="admin-miaosha-control.html"
                   class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors text-sm">
                    <i class="fa fa-cogs mr-2"></i>ç§’æ€æ§åˆ¶
                </a>
            </div>
        </div>
    </div>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="text-center mb-10">
        <h2 class="text-[clamp(1.5rem,3vw,2.2rem)] font-bold text-dark mb-3">æ¯æ—¥é™é‡ç¥¨åˆ¸æŠ¢è´­</h2>
        <p class="text-gray-500 max-w-xl mx-auto">æ¯äººæ¯å¤©é™è´­ä¸€å¼ ç¥¨åˆ¸ï¼Œå…ˆåˆ°å…ˆå¾—ã€‚ç‚¹å‡»ä¸‹æ–¹æ—¥æœŸå¡ç‰‡å³å¯å‚ä¸æŠ¢è´­ã€‚</p>
    </div>

    <!-- æ¥å£åˆ‡æ¢æ§åˆ¶åŒºåŸŸ -->
    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
        <h3 class="text-lg font-bold text-dark mb-4 flex items-center">
            <i class="fa fa-cogs text-primary mr-2"></i>
            è´­ç¥¨æ¥å£é€‰æ‹©
        </h3>

        <div class="flex flex-wrap gap-4 items-center">
            <div class="flex items-center space-x-4">
                <label class="flex items-center cursor-pointer">
                    <input type="radio"
                           v-model="selectedPurchaseApi"
                           value="pessimistic"
                           class="sr-only">
                    <div class="w-6 h-6 border-2 border-gray-300 rounded-full flex items-center justify-center mr-3 transition-colors"
                         :class="{'border-primary bg-primary': selectedPurchaseApi === 'pessimistic'}">
                        <div v-if="selectedPurchaseApi === 'pessimistic'"
                             class="w-3 h-3 bg-white rounded-full"></div>
                    </div>
                    <span class="font-medium text-gray-700">æ‚²è§‚é”è´­ç¥¨</span>
                </label>

                <label class="flex items-center cursor-pointer">
                    <input type="radio"
                           v-model="selectedPurchaseApi"
                           value="optimistic"
                           class="sr-only">
                    <div class="w-6 h-6 border-2 border-gray-300 rounded-full flex items-center justify-center mr-3 transition-colors"
                         :class="{'border-primary bg-primary': selectedPurchaseApi === 'optimistic'}">
                        <div v-if="selectedPurchaseApi === 'optimistic'"
                             class="w-3 h-3 bg-white rounded-full"></div>
                    </div>
                    <span class="font-medium text-gray-700">ä¹è§‚é”è´­ç¥¨</span>
                </label>

                <label class="flex items-center cursor-pointer">
                    <input type="radio"
                           v-model="selectedPurchaseApi"
                           value="async"
                           class="sr-only">
                    <div class="w-6 h-6 border-2 border-gray-300 rounded-full flex items-center justify-center mr-3 transition-colors"
                         :class="{'border-primary bg-primary': selectedPurchaseApi === 'async'}">
                        <div v-if="selectedPurchaseApi === 'async'"
                             class="w-3 h-3 bg-white rounded-full"></div>
                    </div>
                    <span class="font-medium text-gray-700">å¼‚æ­¥æŠ¢è´­</span>
                </label>
            </div>

            <!-- å¿«é€Ÿåˆ‡æ¢æŒ‰é’® -->
            <button @click="togglePurchaseApi"
                    class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 flex items-center space-x-2">
                <i class="fa fa-exchange"></i>
                <span>å¿«é€Ÿåˆ‡æ¢</span>
            </button>

            <!-- å½“å‰æ¥å£çŠ¶æ€æ˜¾ç¤º -->
            <div class="flex items-center space-x-2 px-3 py-2 rounded-lg"
                 :class="{'bg-blue-100 border border-blue-200': selectedPurchaseApi === 'pessimistic',
                              'bg-green-100 border border-green-200': selectedPurchaseApi === 'optimistic',
                              'bg-purple-100 border border-purple-200': selectedPurchaseApi === 'async'}">
                <i :class="{'fa fa-lock text-blue-600': selectedPurchaseApi === 'pessimistic',
                               'fa fa-unlock text-green-600': selectedPurchaseApi === 'optimistic',
                               'fa fa-clock-o text-purple-600': selectedPurchaseApi === 'async'}"></i>
                <span class="text-sm font-medium"
                      :class="{'text-blue-700': selectedPurchaseApi === 'pessimistic',
                                   'text-green-700': selectedPurchaseApi === 'optimistic',
                                   'text-purple-700': selectedPurchaseApi === 'async'}">
                        {{ selectedPurchaseApi === 'pessimistic' ? 'æ‚²è§‚é”æ¨¡å¼' : selectedPurchaseApi === 'optimistic' ? 'ä¹è§‚é”æ¨¡å¼' : 'å¼‚æ­¥æŠ¢è´­æ¨¡å¼'
                    }}
                    </span>
            </div>

            <div class="flex items-center space-x-2 px-3 py-2 bg-gray-100 rounded-lg">
                <i class="fa fa-code text-gray-500"></i>
                <span class="text-sm text-gray-600">
                        API: 
                        <span class="font-medium"
                              :class="{'text-blue-600': selectedPurchaseApi === 'pessimistic', 'text-green-600': selectedPurchaseApi === 'optimistic', 'text-purple-600': selectedPurchaseApi === 'async'}">
                            {{ selectedPurchaseApi === 'pessimistic' ? '/v1/purchase' : selectedPurchaseApi === 'optimistic' ? '/v1/purchase/optimistic' : '/v2/purchase/optimistic'
                            }}
                        </span>
                    </span>
            </div>
        </div>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- æ¥å£è¯´æ˜ -->
            <div class="p-4 bg-blue-50 rounded-lg">
                <div class="flex items-start space-x-3">
                    <i class="fa fa-lightbulb-o text-blue-500 mt-1"></i>
                    <div class="text-sm text-blue-700">
                        <p class="font-medium mb-1">æ¥å£è¯´æ˜ï¼š</p>
                        <ul class="space-y-1">
                            <li><span class="font-medium">æ‚²è§‚é”ï¼š</span>ä½¿ç”¨æ•°æ®åº“è¡Œé”ï¼Œæ•°æ®ä¸€è‡´æ€§å¼ºï¼Œé€‚åˆä½å¹¶å‘åœºæ™¯</li>
                            <li><span class="font-medium">ä¹è§‚é”ï¼š</span>ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶ï¼Œæ€§èƒ½è¾ƒé«˜ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼Œå¯èƒ½å‡ºç°é‡è¯•
                            </li>
                            <li><span class="font-medium">å¼‚æ­¥æŠ¢è´­ï¼š</span>è¯·æ±‚åŠ å…¥é˜Ÿåˆ—å¼‚æ­¥å¤„ç†ï¼Œé€‚åˆè¶…é«˜å¹¶å‘åœºæ™¯ï¼Œéœ€è¦è½®è¯¢æŸ¥è¯¢ç»“æœ
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- æ¥å£æµ‹è¯• -->
            <div class="p-4 bg-green-50 rounded-lg">
                <div class="flex items-start space-x-3">
                    <i class="fa fa-check-circle text-green-500 mt-1"></i>
                    <div class="text-sm text-green-700">
                        <p class="font-medium mb-1">æ¥å£çŠ¶æ€ï¼š</p>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <span>æ‚²è§‚é”æ¥å£:</span>
                                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">æ­£å¸¸</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span>ä¹è§‚é”æ¥å£:</span>
                                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">æ­£å¸¸</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span>å¼‚æ­¥æŠ¢è´­æ¥å£:</span>
                                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">æ­£å¸¸</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½çŠ¶æ€ -->
    <div v-if="loading" class="flex justify-center items-center py-16">
        <div class="text-center">
            <i class="fa fa-spinner fa-spin text-3xl text-primary mb-4"></i>
            <p class="text-gray-500">åŠ è½½ç¥¨åˆ¸ä¿¡æ¯ä¸­...</p>
        </div>
    </div>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <div v-if="error" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-8 text-center">
        <i class="fa fa-exclamation-circle text-red-500 mr-2"></i>
        <span class="text-red-500">{{ error }}</span>
    </div>

    <!-- ç¥¨æ•°å¡ç‰‡å®¹å™¨ - åªå±•ç¤ºæœ€è¿‘3å¤© -->
    <div v-if="!loading && !error" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
        <!-- ç¥¨åˆ¸å¡ç‰‡ -->
        <div v-for="(ticket, index) in tickets" :key="index"
             class="bg-white rounded-xl overflow-hidden shadow-md card-hover"
             :class="{'border-t-4 border-primary': index === 0,
                          'border-t-4 border-secondary': index === 1,
                          'border-t-4 border-accent': index === 2}">
            <div class="p-1"
                 :class="{'bg-gradient-to-r from-primary to-blue-400': index === 0,
                              'bg-gradient-to-r from-secondary to-emerald-400': index === 1,
                              'bg-gradient-to-r from-accent to-amber-400': index === 2}"></div>
            <div class="p-6">
                <div class="flex justify-between items-start mb-5">
                    <div>
                        <h3 class="text-lg font-bold text-dark">{{ ticket.formattedDate }}</h3>
                        <p class="text-gray-500">{{ ticket.weekday }}</p>
                    </div>
                    <span :class="{'bg-primary/10 text-primary': index === 0,
                                       'bg-secondary/10 text-secondary': index === 1,
                                       'bg-accent/10 text-accent': index === 2}"
                          class="text-xs px-2 py-1 rounded-full font-medium">
                            {{ index === 0 ? 'ä»Šå¤©' : index === 1 ? 'æ˜å¤©' : 'åå¤©' }}
                        </span>
                </div>

                <div class="flex items-center justify-center mb-6">
                    <div class="relative w-24 h-24 flex items-center justify-center">
                        <div class="star-rotate text-accent">
                            <i class="fa fa-star text-5xl"></i>
                        </div>
                        <div class="absolute text-center">
                            <span class="text-2xl font-bold text-dark">{{ ticket.remaining }}</span>
                            <span class="text-gray-500">å¼ </span>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-500">å‰©ä½™ç¥¨æ•°</span>
                        <span class="font-medium">{{ ticket.remaining }} / {{ ticket.total }}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div :class="{'bg-primary': index === 0,
                                          'bg-secondary': index === 1,
                                          'bg-accent': index === 2,
                                          'bg-danger': ticket.remaining / ticket.total < 0.2}"
                             class="h-2.5 rounded-full"
                             :style="{ width: (ticket.remaining / ticket.total) * 100 + '%' }"></div>
                    </div>
                </div>

                <button @click="handlePurchase(ticket)"
                        :disabled="isButtonDisabled(ticket)"
                        :class="getButtonClass(ticket, index)">
                    <i v-if="getButtonIcon(ticket)" :class="getButtonIcon(ticket)"></i>
                    <span>{{ getButtonText(ticket) }}</span>
                </button>
                <div v-if="purchaseStatus === 'polling'"
                     class="mt-2 text-purple-600 text-sm flex items-center justify-center">
                    <i class="fa fa-spinner fa-spin mr-2"></i>
                    <span>ğŸ”¥ è¯·æ±‚å·²æäº¤ï¼Œæ­£åœ¨å…¨åŠ›æŠ¢è´­ä¸­ï¼Œè¯·ç¨å€™... (ç¬¬{{pollingCount}}æ¬¡æŸ¥è¯¢)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- æŠ¢è´­è§„åˆ™ -->
    <div class="bg-white rounded-xl shadow-md p-6 mb-10">
        <h3 class="text-xl font-bold text-dark mb-4 flex items-center">
            <i class="fa fa-info-circle text-primary mr-2"></i>
            æŠ¢è´­è§„åˆ™
        </h3>

        <ul class="space-y-3 text-gray-600">
            <li class="flex items-start">
                <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                <span>æ¯äººæ¯å¤©é™è´­ä¸€å¼ ç¥¨åˆ¸ï¼Œé‡å¤æŠ¢è´­å°†å¤±è´¥</span>
            </li>
            <li class="flex items-start">
                <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                <span>ç¥¨åˆ¸æŠ¢è´­æˆåŠŸåï¼Œå°†ä¸ºæ‚¨ä¿ç•™24å°æ—¶ï¼Œè¯·åŠæ—¶ä½¿ç”¨</span>
            </li>
            <li class="flex items-start">
                <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                <span>ç¥¨åˆ¸ä¸€æ—¦å”®å‡ºï¼Œä¸é€€ä¸æ¢ï¼Œè¯·ç¡®è®¤æ—¥æœŸåå†æŠ¢è´­</span>
            </li>
            <li class="flex items-start">
                <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                <span>æ¯æ—¥0ç‚¹æ›´æ–°ç¥¨æ•°ï¼Œå”®å®Œå³æ­¢</span>
            </li>
            <li class="flex items-start">
                <i class="fa fa-shield text-accent mt-1 mr-2"></i>
                <span>æŠ¢è´­é‡‡ç”¨åŒé‡éªŒè¯æœºåˆ¶ï¼Œç¡®ä¿å®‰å…¨æ€§å’Œå…¬å¹³æ€§</span>
            </li>
        </ul>
    </div>

    <!-- æŠ¢è´­çŠ¶æ€æç¤º -->
    <div v-if="isPurchasing" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-8 text-center">
        <div class="flex items-center justify-center space-x-3">
            <i class="fa fa-spinner fa-spin text-blue-500 text-xl"></i>
            <div>
                <p class="text-blue-800 font-medium">æ­£åœ¨æŠ¢è´­ä¸­...</p>
                <p class="text-blue-600 text-sm">è¯·è€å¿ƒç­‰å¾…ï¼Œç³»ç»Ÿæ­£åœ¨å¤„ç†æ‚¨çš„æŠ¢è´­è¯·æ±‚</p>
            </div>
        </div>
    </div>

    <!-- å¼‚æ­¥æŠ¢è´­è½®è¯¢çŠ¶æ€æç¤º -->
    <div v-if="isPolling" class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-8 text-center">
        <div class="flex items-center justify-center space-x-3">
            <i class="fa fa-clock-o text-purple-500 text-xl"></i>
            <div>
                <p class="text-purple-800 font-medium">æ­£åœ¨æ’é˜Ÿä¸­...</p>
                <p class="text-purple-600 text-sm">æ‚¨çš„æŠ¢è´­è¯·æ±‚å·²åŠ å…¥é˜Ÿåˆ—ï¼Œæ­£åœ¨ç­‰å¾…å¤„ç†ï¼Œè¯·ç¨å€™</p>
                <p class="text-purple-500 text-xs mt-1">è¯·æ±‚ID: {{ asyncRequestId }}</p>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤æŠ¢è´­å¼¹çª— -->
    <div v-if="showConfirmModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 transform transition-all duration-300 scale-100">
            <div class="text-center mb-5">
                <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-ticket text-primary text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-dark">ç¡®è®¤æŠ¢è´­</h3>
                <p class="text-gray-500 mt-2">
                    æ‚¨ç¡®å®šè¦æŠ¢è´­{{ selectedTicket.formattedDate }}ï¼ˆ{{ selectedTicket.weekday }}ï¼‰çš„ç¥¨åˆ¸å—ï¼Ÿæ¯äººæ¯å¤©é™è´­ä¸€å¼ ã€‚
                </p>
                <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center justify-center space-x-2">
                        <i :class="{'fa fa-lock text-blue-500': selectedPurchaseApi === 'pessimistic',
                                       'fa fa-unlock text-green-500': selectedPurchaseApi === 'optimistic',
                                       'fa fa-clock-o text-purple-500': selectedPurchaseApi === 'async'}"></i>
                        <span class="text-sm font-medium"
                              :class="{'text-blue-600': selectedPurchaseApi === 'pessimistic',
                                           'text-green-600': selectedPurchaseApi === 'optimistic',
                                           'text-purple-600': selectedPurchaseApi === 'async'}">
                                ä½¿ç”¨{{ selectedPurchaseApi === 'pessimistic' ? 'æ‚²è§‚é”' : selectedPurchaseApi === 'optimistic' ? 'ä¹è§‚é”' : 'å¼‚æ­¥æŠ¢è´­'
                            }}æ¥å£
                            </span>
                    </div>
                </div>
            </div>

            <div class="flex space-x-3">
                <button @click="showConfirmModal = false"
                        class="flex-1 py-3 border border-gray-200 rounded-lg font-medium hover:bg-gray-50 transition-colors">
                    å–æ¶ˆ
                </button>
                <button @click="confirmPurchase()"
                        class="flex-1 py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors">
                    ç¡®è®¤æŠ¢è´­
                </button>
            </div>
        </div>
    </div>

    <!-- æŠ¢è´­æˆåŠŸå¼¹çª— -->
    <div v-if="showSuccessModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-check text-green-500 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-green-500">æŠ¢è´­æˆåŠŸï¼</h3>
                <p class="text-gray-500 mt-2 mb-5">
                    æ‚¨å·²æˆåŠŸæŠ¢è´­{{ successTicketDate }}çš„ç¥¨åˆ¸
                </p>

                <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
                    <p class="text-sm"><span class="text-gray-500">ç¥¨åˆ¸ç¼–å·ï¼š</span> <span
                            class="font-medium">{{ ticketCode }}</span></p>
                    <p class="text-sm mt-1"><span class="text-gray-500">æœ‰æ•ˆæ—¥æœŸï¼š</span> <span
                            class="font-medium">{{ successTicketDate }}</span></p>
                </div>

                <button @click="showSuccessModal = false"
                        class="w-full py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors">
                    å®Œæˆ
                </button>
            </div>
        </div>
    </div>

    <!-- æŠ¢è´­å¤±è´¥å¼¹çª— -->
    <div v-if="showFailModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <div class="text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-times text-red-500 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-red-500">æŠ¢è´­å¤±è´¥</h3>
                <p class="text-gray-500 mt-2 mb-6">{{ failMessage }}</p>

                <button @click="showFailModal = false"
                        class="w-full py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-colors">
                    ç¡®å®š
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    const {createApp} = Vue;

    createApp({
        data() {
            return {
                // ç§’æ€æ´»åŠ¨çŠ¶æ€
                miaoshaStatus: {},

                tickets: [],
                loading: true,
                error: '',
                currentUser: '', // å½“å‰ç™»å½•ç”¨æˆ·æ˜µç§°
                currentUserId: -1, // å½“å‰ç”¨æˆ·IDï¼Œé»˜è®¤-1è¡¨ç¤ºåŒ¿åç”¨æˆ·
                selectedTicket: null,
                showConfirmModal: false,
                showSuccessModal: false,
                showFailModal: false,
                successTicketDate: '',
                ticketCode: '',
                failMessage: '',
                purchasedDates: [], // å·²è´­ä¹°çš„æ—¥æœŸ
                isPurchasing: false, // æŠ¢è´­è¿›è¡Œä¸­çŠ¶æ€
                selectedPurchaseApi: 'pessimistic', // é»˜è®¤é€‰æ‹©æ‚²è§‚é”æ¥å£
                asyncRequestId: '', // å¼‚æ­¥æŠ¢è´­è¯·æ±‚ID
                isPolling: false, // æ˜¯å¦æ­£åœ¨è½®è¯¢
                pollingInterval: null, // è½®è¯¢å®šæ—¶å™¨
                purchaseStatus: 'idle', // idle, submitting, polling, success, fail
                pollingCount: 0,
                pollingTimer: null,
                pollingTimeoutTimer: null,
                maxPollingTime: 30000,
            }
        },
        computed: {
            // æ—¥å¿—è®°å½•å™¨
            LOGGER() {
                return {
                    info: (message, ...args) => console.log(`[INFO] ${message}`, ...args),
                    warn: (message, ...args) => console.warn(`[WARN] ${message}`, ...args),
                    error: (message, ...args) => console.error(`[ERROR] ${message}`, ...args),
                    debug: (message, ...args) => console.debug(`[DEBUG] ${message}`, ...args)
                };
            }
        },
        mounted() {
            // æ³¨é‡Šæ‰ç™»å½•çŠ¶æ€æ£€æŸ¥ï¼Œç›´æ¥åŠ è½½ç¥¨åˆ¸æ•°æ®
            // å…ˆæ£€æŸ¥ç™»å½•çŠ¶æ€ï¼Œç„¶ååŠ è½½ç¥¨åˆ¸æ•°æ®
            // this.checkLoginStatus().then(() => {
            //     this.loadTickets();
            // });

            // ç›´æ¥åŠ è½½ç¥¨åˆ¸æ•°æ®ï¼Œä¸æ£€æŸ¥ç™»å½•çŠ¶æ€
            this.loadTickets();

            // è·å–ç§’æ€æ´»åŠ¨çŠ¶æ€
            this.loadMiaoshaStatus();
        },
        beforeUnmount() {
            // ç»„ä»¶é”€æ¯å‰æ¸…ç†è½®è¯¢å®šæ—¶å™¨
            this.stopPolling();
        },
        methods: {
            // Add sleep helper at the top of methods
            async sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            },

            // æ³¨é‡Šæ‰ç™»å½•çŠ¶æ€æ£€æŸ¥æ–¹æ³•
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            // async checkLoginStatus() {
            //     const token = localStorage.getItem('token');
            //     if (!token) {
            //         // æ²¡æœ‰tokenï¼Œè®¾ç½®ç”¨æˆ·ä¸ºæœªç™»å½•çŠ¶æ€
            //         this.currentUser = '';
            //         this.currentUserId = '';
            //         return Promise.resolve();
            //     }
            //
            //     try {
            //         // éªŒè¯tokenå¹¶è·å–ç”¨æˆ·ä¿¡æ¯
            //         const response = await axios.get('http://localhost:8081/api/auth/me', {
            //             headers: {
            //                 'Authorization': 'Bearer ' + token
            //             }
            //         });
            //
            //         if (response.data.code === 200) {
            //             const user = response.data.data;
            //             this.currentUser = user.nickname || user.username;
            //             this.currentUserId = user.id;
            //
            //             // è®¾ç½®å…¨å±€axiosé»˜è®¤header
            //             axios.defaults.headers.common['Authorization'] = 'Bearer ' + token;
            //         } else {
            //             // tokenæ— æ•ˆï¼Œæ¸…é™¤å¹¶è®¾ç½®ä¸ºæœªç™»å½•
            //             localStorage.removeItem('token');
            //             localStorage.removeItem('user');
            //             this.currentUser = '';
            //             this.currentUserId = '';
            //         }
            //     } catch (err) {
            //         console.error('éªŒè¯ç™»å½•çŠ¶æ€å¤±è´¥:', err);
            //         // ç½‘ç»œé”™è¯¯æˆ–tokenæ— æ•ˆï¼Œè®¾ç½®ä¸ºæœªç™»å½•
            //         localStorage.removeItem('token');
            //         localStorage.removeItem('user');
            //         this.currentUser = '';
            //         this.currentUserId = '';
            //     }
            //
            //     return Promise.resolve();
            // },

            // è·å–ç§’æ€æ´»åŠ¨çŠ¶æ€
            async loadMiaoshaStatus() {
                try {
                    const response = await axios.get('http://localhost:8081/api/tickets/miaosha/status');
                    if (response.data.code === 200) {
                        this.miaoshaStatus = response.data.data;
                    }
                } catch (error) {
                    console.error('è·å–ç§’æ€çŠ¶æ€å¤±è´¥:', error);
                }
            },

            // ä»åç«¯åŠ è½½ç¥¨åˆ¸æ•°æ®
            async loadTickets() {
                try {
                    this.loading = true;
                    // æ³¨é‡Šæ‰è®¤è¯ç›¸å…³ä»£ç ï¼Œç›´æ¥è°ƒç”¨API
                    // ä½¿ç”¨å…¨å±€è®¾ç½®çš„axiosé»˜è®¤headerï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ token
                    // è°ƒç”¨æ–°çš„æ¥å£ï¼Œè·å–åŒ…å«ç”¨æˆ·è´­ä¹°çŠ¶æ€çš„ç¥¨åˆ¸ä¿¡æ¯
                    const response = await axios.get('http://localhost:8081/api/tickets/listWithUserStatus', {
                        params: {
                            userId: this.currentUserId || null
                        }
                    });

                    if (response.data.code === 200) {
                        this.tickets = response.data.data;
                        this.error = '';

                        // æ›´æ–°å·²è´­ä¹°æ—¥æœŸåˆ—è¡¨
                        this.updatePurchasedDates();
                        console.log('Tickets loaded:', this.tickets);
                    } else {
                        this.error = response.data.message || 'åŠ è½½ç¥¨åˆ¸å¤±è´¥';
                    }
                } catch (err) {
                    // æ³¨é‡Šæ‰401é”™è¯¯å¤„ç†ï¼Œç®€åŒ–é”™è¯¯å¤„ç†é€»è¾‘
                    // if (err.response && err.response.status === 401) {
                    //     // æœªæˆæƒï¼Œéœ€è¦ç™»å½•
                    //     this.error = 'è¯·å…ˆç™»å½•åå†æŸ¥çœ‹ç¥¨åˆ¸ä¿¡æ¯';
                    //     console.error('ç¥¨åˆ¸åˆ—è¡¨è®¿é—®å¤±è´¥:', err);
                    // } else {
                    //     this.error = 'ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•åŠ è½½ç¥¨åˆ¸ä¿¡æ¯';
                    //     console.error(err);
                    // }

                    this.error = 'ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•åŠ è½½ç¥¨åˆ¸ä¿¡æ¯';
                    console.error(err);
                } finally {
                    console.log('Setting loading to false');
                    this.loading = false;
                    this.$forceUpdate(); // Force Vue to re-render if reactivity issue
                }
            },

            // æ›´æ–°å·²è´­ä¹°æ—¥æœŸåˆ—è¡¨
            updatePurchasedDates() {
                this.purchasedDates = [];
                for (const ticket of this.tickets) {
                    if (ticket.userPurchased) {
                        this.purchasedDates.push(ticket.formattedDate);
                    }
                }
                this.LOGGER.info('å·²è´­ä¹°æ—¥æœŸåˆ—è¡¨æ›´æ–°: {}', this.purchasedDates);
            },

            // å¤„ç†æŠ¢è´­ç‚¹å‡»äº‹ä»¶
            handlePurchase(ticket) {
                // æ£€æŸ¥ç§’æ€æ´»åŠ¨çŠ¶æ€
                if (this.miaoshaStatus.paused) {
                    this.failMessage = 'ç§’æ€æ´»åŠ¨æ­£åœ¨ç»´æŠ¤ä¸­ï¼Œè¯·ç¨åå†è¯•';
                    this.showFailModal = true;
                    return;
                }

                // æ³¨é‡Šæ‰ç™»å½•æ£€æŸ¥ï¼Œå…è®¸æœªç™»å½•ç”¨æˆ·æŠ¢è´­
                // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
                // if (!this.currentUser) {
                //     this.failMessage = 'è¯·å…ˆç™»å½•åå†æŠ¢è´­ç¥¨åˆ¸';
                //     this.showFailModal = true;
                //     return;
                // }

                this.selectedTicket = ticket;
                this.showConfirmModal = true;
            },

            // ç¡®è®¤æŠ¢è´­
            async confirmPurchase() {
                if (!this.selectedTicket) return;

                try {
                    // éšè—ç¡®è®¤å¼¹çª—
                    this.showConfirmModal = false;

                    // è®¾ç½®æŠ¢è´­è¿›è¡Œä¸­çŠ¶æ€
                    this.isPurchasing = true;

                    // ç¬¬ä¸€æ­¥ï¼šè·å–éªŒè¯å€¼verifyHash
                    this.LOGGER.info('å¼€å§‹è·å–éªŒè¯å€¼ï¼Œç”¨æˆ·ID: {}, æ—¥æœŸ: {}', this.currentUserId, this.selectedTicket.date);

                    const verifyResponse = await axios.get('http://localhost:8081/api/tickets/getVerifyHash', {
                        params: {
                            userId: this.currentUserId,
                            date: this.selectedTicket.date
                        }
                    });

                    if (verifyResponse.data.code !== 200) {
                        this.failMessage = verifyResponse.data.message || 'è·å–éªŒè¯å€¼å¤±è´¥';
                        this.showFailModal = true;
                        return;
                    }

                    const verifyHash = verifyResponse.data.data;
                    this.LOGGER.info('è·å–éªŒè¯å€¼æˆåŠŸ: {}', verifyHash);

                    // ç¬¬äºŒæ­¥ï¼šæºå¸¦verifyHashå‘é€æŠ¢è´­è¯·æ±‚
                    this.LOGGER.info('å¼€å§‹å‘é€æŠ¢è´­è¯·æ±‚ï¼Œç”¨æˆ·ID: {}, æ—¥æœŸ: {}, éªŒè¯å€¼: {}, æ¥å£ç±»å‹: {}',
                        this.currentUserId, this.selectedTicket.date, verifyHash, this.selectedPurchaseApi);

                    // æ ¹æ®é€‰æ‹©çš„æ¥å£ç±»å‹åŠ¨æ€é€‰æ‹©APIåœ°å€
                    let apiUrl = '';
                    if (this.selectedPurchaseApi === 'optimistic') {
                        apiUrl = 'http://localhost:8081/api/tickets/v1/purchase/optimistic';
                    } else if (this.selectedPurchaseApi === 'async') {
                        apiUrl = 'http://localhost:8081/api/tickets/v2/purchase/optimistic';
                    } else {
                        apiUrl = 'http://localhost:8081/api/tickets/v1/purchase';
                    }

                    this.LOGGER.info('ä½¿ç”¨æ¥å£: {}', apiUrl);

                    const response = await axios.post(apiUrl, {
                        userId: this.currentUserId,
                        date: this.selectedTicket.date,
                        verifyHash: verifyHash
                    });

                    if (response.data.code === 200) {
                        if (this.selectedPurchaseApi === 'async') {
                            this.purchaseStatus = 'submitting';
                            const result = response.data.data;
                            this.asyncRequestId = result.requestId;

                            if (!this.asyncRequestId) {
                                this.purchaseStatus = 'fail';
                                this.failMessage = 'æŠ¢è´­å¤±è´¥ï¼Œè¯·é‡è¯•';
                                this.showFailModal = true;
                                this.LOGGER.warn('å¼‚æ­¥æŠ¢è´­å¤±è´¥ï¼ŒrequestIdä¸ºç©º');
                            } else {
                                this.purchaseStatus = 'polling';
                                this.LOGGER.info('å¼‚æ­¥æŠ¢è´­è¯·æ±‚å·²æäº¤ï¼Œè¯·æ±‚ID: {}, å¼€å§‹è½®è¯¢æŸ¥è¯¢ç»“æœ', this.asyncRequestId);
                                this.startPolling();
                            }
                        } else {
                            // åŒæ­¥æŠ¢è´­æˆåŠŸ
                            const record = response.data.data;
                            this.successTicketDate = this.selectedTicket.formattedDate;
                            this.ticketCode = record.ticketCode;
                            this.purchasedDates.push(this.selectedTicket.formattedDate);

                            // æ›´æ–°ç¥¨åˆ¸æ•°é‡
                            this.selectedTicket.remaining--;

                            this.LOGGER.info('æŠ¢è´­æˆåŠŸï¼Œç¥¨åˆ¸ç¼–ç : {}, è®¢å•å·: {}', record.ticketCode, record.orderNo || 'N/A');

                            // æ˜¾ç¤ºæˆåŠŸå¼¹çª—
                            this.showSuccessModal = true;
                        }
                    } else {
                        // æŠ¢è´­å¤±è´¥
                        this.failMessage = response.data.message || 'æŠ¢è´­å¤±è´¥ï¼Œè¯·é‡è¯•';
                        this.showFailModal = true;
                        this.LOGGER.warn('æŠ¢è´­å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯: {}', this.failMessage);
                    }
                } catch (err) {
                    this.LOGGER.error('æŠ¢è´­æµç¨‹å¼‚å¸¸: {}', err.message, err);

                    if (err.response) {
                        // æœåŠ¡å™¨è¿”å›é”™è¯¯
                        if (err.response.status === 400) {
                            this.failMessage = err.response.data.message || 'è¯·æ±‚å‚æ•°é”™è¯¯';
                        } else if (err.response.status === 500) {
                            this.failMessage = 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
                        } else {
                            this.failMessage = `è¯·æ±‚å¤±è´¥ (${err.response.status}): ${err.response.data.message || 'æœªçŸ¥é”™è¯¯'}`;
                        }
                    } else if (err.request) {
                        // ç½‘ç»œé”™è¯¯
                        this.failMessage = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•';
                    } else {
                        // å…¶ä»–é”™è¯¯
                        this.failMessage = 'æŠ¢è´­å¤±è´¥ï¼Œè¯·é‡è¯•';
                    }

                    this.showFailModal = true;
                } finally {
                    // åªæœ‰éå¼‚æ­¥æŠ¢è´­æ—¶æ‰é‡ç½®æŠ¢è´­çŠ¶æ€
                    // å¼‚æ­¥æŠ¢è´­çš„çŠ¶æ€ç”±è½®è¯¢æœºåˆ¶ç®¡ç†
                    if (this.selectedPurchaseApi !== 'async') {
                        this.isPurchasing = false;
                    }
                }
            },

            // åˆ‡æ¢è´­ç¥¨æ¥å£
            togglePurchaseApi() {
                if (this.selectedPurchaseApi === 'pessimistic') {
                    this.selectedPurchaseApi = 'optimistic';
                } else if (this.selectedPurchaseApi === 'optimistic') {
                    this.selectedPurchaseApi = 'async';
                } else {
                    this.selectedPurchaseApi = 'pessimistic';
                }
                this.LOGGER.info('åˆ‡æ¢è´­ç¥¨æ¥å£: {}', this.selectedPurchaseApi);
            },

            // å¼€å§‹è½®è¯¢æŸ¥è¯¢å¼‚æ­¥æŠ¢è´­ç»“æœ
            async startPolling() {
                this.stopPolling(); // Clear any existing, though not needed now
                this.pollingCount = 0;
                const startTime = Date.now();

                while (true) {
                    const status = await this.pollPurchaseResult();
                    if (status === 'SUCCESS' || status === 'FAILED' || status === 'TIMEOUT') {
                        break;
                    }
                    
                    // Check timeout
                    if (Date.now() - startTime > this.maxPollingTime) {
                        this.handlePollingTimeout();
                        break;
                    }
                    
                    await this.sleep(1000);
                }
            },

            // åœæ­¢è½®è¯¢
            stopPolling() {
                if (this.pollingTimer) clearInterval(this.pollingTimer);
                if (this.pollingTimeoutTimer) clearTimeout(this.pollingTimeoutTimer);
                this.pollingTimer = null;
                this.pollingTimeoutTimer = null;
                this.pollingCount = 0;
            },

            // è½®è¯¢æŸ¥è¯¢å¼‚æ­¥æŠ¢è´­ç»“æœ
            async pollPurchaseResult() {
                this.pollingCount++;
                try {
                    const response = await axios.get('http://localhost:8081/api/tickets/v2/purchaseResult', {
                        params: {
                            requestId: this.asyncRequestId,
                            userId: this.currentUserId,
                            date: this.selectedTicket.date
                        }
                    });
                    
                    if (response.data.code === 200) {
                        const result = response.data.data;
                        const status = result.status;
                        
                        this.LOGGER.info('è½®è¯¢æŸ¥è¯¢ç»“æœï¼Œè¯·æ±‚ID: {}, çŠ¶æ€: {}', this.asyncRequestId, status);
                        
                        if (status === 'SUCCESS') {
                            this.purchaseStatus = 'success';
                            this.successTicketDate = this.selectedTicket.formattedDate;
                            this.ticketCode = result.ticketCode;
                            this.purchasedDates.push(this.selectedTicket.formattedDate);
                            this.selectedTicket.remaining--;
                            this.LOGGER.info('å¼‚æ­¥æŠ¢è´­æˆåŠŸï¼Œç¥¨åˆ¸ç¼–ç : {}, è®¢å•å·: {}', result.ticketCode, result.orderNo || 'N/A');
                            this.showSuccessModal = true;
                        } else if (status === 'FAILED' || status === 'TIMEOUT') {
                            this.purchaseStatus = 'fail';
                            this.failMessage = result.message || 'æŠ¢è´­å¤±è´¥ï¼Œè¯·é‡è¯•';
                            this.showFailModal = true;
                            this.LOGGER.warn('å¼‚æ­¥æŠ¢è´­å¤±è´¥ï¼Œè¯·æ±‚ID: {}, é”™è¯¯: {}', this.asyncRequestId, this.failMessage);
                        } else if (status === 'QUEUED') {
                            this.LOGGER.info('å¼‚æ­¥æŠ¢è´­è¿˜åœ¨æ’é˜Ÿä¸­ï¼Œè¯·æ±‚ID: {}, ç»§ç»­è½®è¯¢', this.asyncRequestId);
                        }
                        
                        return status;
                    } else {
                        this.LOGGER.error('è½®è¯¢æŸ¥è¯¢å¤±è´¥: {}', response.data.message);
                        return 'FAILED';
                    }
                } catch (error) {
                    this.LOGGER.error('è½®è¯¢æŸ¥è¯¢å¼‚å¸¸: {}', error.message);
                    return 'FAILED';
                }
            },

            // å¤„ç†è½®è¯¢è¶…æ—¶
            handlePollingTimeout() {
                if (this.purchaseStatus === 'polling') {
                    this.stopPolling();
                    this.purchaseStatus = 'fail';
                    this.failMessage = 'æŠ¢è´­å¤„ç†è¶…æ—¶ï¼Œè¯·å‰å¾€ã€Œæˆ‘çš„è®¢å•ã€æŸ¥çœ‹ç¡®è®¤ï¼Œæˆ–ç¨åé‡è¯•';
                    this.showFailModal = true;
                }
            },

            // æ³¨é‡Šæ‰é€€å‡ºç™»å½•å’Œè·³è½¬ç™»å½•é¡µé¢æ–¹æ³•
            // é€€å‡ºç™»å½•
            // async logout() {
            //     try {
            //         // è°ƒç”¨åç«¯é€€å‡ºæ¥å£
            //         await axios.post('http://localhost:8081/api/auth/logout');
            //     } catch (err) {
            //         console.error('é€€å‡ºç™»å½•å¤±è´¥:', err);
            //     } finally {
            //         // æ— è®ºæ˜¯å¦æˆåŠŸï¼Œéƒ½æ¸…é™¤æœ¬åœ°æ•°æ®
            //         localStorage.removeItem('token');
            //         localStorage.removeItem('user');
            //         delete axios.defaults.headers.common['Authorization'];
            //         // é‡æ–°åŠ è½½å½“å‰é¡µé¢ï¼Œæ˜¾ç¤ºæœªç™»å½•çŠ¶æ€
            //         window.location.reload();
            //     }
            // },

            // è·³è½¬åˆ°ç™»å½•é¡µé¢
            // goToLogin() {
            //     window.location.href = 'login.html';
            // }

            isButtonDisabled(ticket) {
                return ticket.remaining <= 0 || this.purchasedDates.includes(ticket.formattedDate) || this.purchaseStatus === 'submitting' || this.purchaseStatus === 'polling';
            },

            getButtonText(ticket) {
                if (this.purchaseStatus === 'submitting') return 'æäº¤ä¸­...';
                if (this.purchaseStatus === 'polling') return 'æ’é˜Ÿä¸­...';
                if (ticket.remaining <= 0) return 'å·²å”®ç½„';
                if (this.purchasedDates.includes(ticket.formattedDate)) return 'å·²æŠ¢è´­';
                return 'ç«‹å³æŠ¢è´­';
            },

            getButtonClass(ticket, index) {
                let baseClass = 'w-full py-3 text-white rounded-lg font-medium flex items-center justify-center space-x-2 transition-colors relative';

                if (this.purchaseStatus === 'submitting' || this.purchaseStatus === 'polling') {
                    return `${baseClass} bg-gray-400 cursor-not-allowed animate-pulse`;
                }

                if (ticket.remaining <= 0 || this.purchasedDates.includes(ticket.formattedDate)) {
                    return `${baseClass} bg-gray-200 text-gray-500 cursor-not-allowed`;
                }

                let colorClass = '';
                if (index === 0) colorClass = 'bg-primary hover:bg-primary/90 pulse';
                else if (index === 1) colorClass = 'bg-secondary hover:bg-secondary/90';
                else if (index === 2) colorClass = 'bg-accent hover:bg-accent/90';

                return `${baseClass} ${colorClass}`;
            },

            getButtonIcon(ticket) {
                if (this.purchaseStatus === 'submitting' || this.purchaseStatus === 'polling') return 'fa fa-spinner fa-spin';
                if (ticket.remaining <= 0) return 'fa fa-times';
                if (this.purchasedDates.includes(ticket.formattedDate)) return 'fa fa-check';
                if (ticket.remaining > 0 && !this.purchasedDates.includes(ticket.formattedDate)) return 'fa fa-shopping-cart';
                return '';
            }
        }
    }).mount('#app');
</script>
</body>
</html>
