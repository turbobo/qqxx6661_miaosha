## 项目拷贝自 qqxx6661/miaosha 加上自己的注释

前端文件 index.html
后端 TicketController.java

# 票券抢购系统使用说明书

## 系统概述
票券抢购系统是一个每日限量票券抢购平台，支持高并发场景下的票券购买。系统使用 Vue.js 前端框架，集成多种并发控制机制（悲观锁、乐观锁、异步抢购）。每人每天限购一张票券，先到先得。系统默认以匿名用户模式运行（用户ID: -1），无需登录即可体验。

### 系统特点
- **票券显示**：仅展示最近3天的票券信息，包括剩余票数、进度条。
- **接口切换**：支持悲观锁（/v1/purchase）、乐观锁（/v1/purchase/optimistic）、异步抢购（/v2/purchase/optimistic）。
- **抢购反馈**：实时加载状态、成功/失败弹窗、轮询机制（异步模式）。
- **管理功能**：管理员可访问票券管理、票数检查、秒杀控制。
- **订单管理**：通过“我的订单”查看和取消订单（仅限待支付状态且在24小时内）。

**注意**：系统后端运行于 http://localhost:8081。确保后端服务启动后访问页面。

## 界面导航
打开浏览器访问 index.html，界面分为以下部分：

1. **顶部导航**：
    - 系统标题：票券抢购系统 V1。
    - 秒杀活动状态：如果维护中，显示黄色警告条。
    - 用户信息：显示“匿名用户”（固定，无需登录）。

2. **管理功能导航**（白色卡片）：
    - **票券管理**：链接到 admin-ticket-update.html，管理员更新票券。
    - **票数检查**：链接到 ticket-validation.html，验证票数合法性。
    - **秒杀控制**：链接到 admin-miaosha-control.html，暂停/恢复秒杀。
    - **我的订单**：链接到 orders.html，查看订单列表和详情。

3. **页面标题**：每日限量票券抢购，包含规则说明。

4. **购票接口选择**（白色卡片）：
    - 单选按钮：悲观锁购票、乐观锁购票、异步抢购（默认: 悲观锁）。
    - 快速切换按钮：点击循环切换模式。
    - 当前接口状态：显示模式（如“悲观锁模式”）和 API 路径。
    - 接口说明：简述每种模式的优缺点。
    - 接口状态：显示所有接口为“正常”。

5. **票券卡片**（3张卡片，网格布局）：
    - 显示日期、周几、剩余票数/总票数、进度条。
    - 按钮：立即抢购（可点击时蓝色/绿色/橙色，根据日期）；已售罄/已抢购（灰色禁用）；提交中.../排队中...（异步时，带加载动画）。
    - 异步轮询提示：排队中显示“🔥 请求已提交，正在全力抢购中，请稍候... (第X次查询)” + 旋转图标。

6. **抢购规则**（白色卡片）：
    - 列出限购规则、保留时间、不退不换等。

7. **状态提示**：
    - 抢购中...（蓝色条，带旋转图标）。
    - 正在排队中...（紫色条，异步时显示请求ID）。

8. **弹窗**：
    - 确认抢购：显示日期、接口类型，确认/取消按钮。
    - 抢购成功：显示票券编号、有效日期，完成按钮。
    - 抢购失败：显示失败原因，确定按钮。

## 抢购操作步骤
### 步骤1: 选择购票接口
1. 在“购票接口选择”区域，选择模式（单选按钮或点击“快速切换”）。
2. 查看接口说明和状态，确保为“正常”。

### 步骤2: 抢购票券
1. 查看票券卡片（最近3天）。
2. 点击“立即抢购”按钮（如果禁用，检查剩余票数或是否已购）。
3. 弹出“确认抢购”弹窗：确认日期和接口类型，点击“确认抢购”。
4. 系统处理：
    - **悲观/乐观锁**：显示“正在抢购中...”；成功弹出“抢购成功！”弹窗，更新剩余票数；失败弹出原因。
    - **异步抢购**：
        - 按钮变“提交中...”（pulse动画）。
        - 提交成功后变“排队中...”，显示轮询提示（计数+动画）。
        - 每1秒轮询结果：成功关闭轮询，弹出订单信息；失败/超时显示提示，重置按钮。
        - 最大30秒超时：显示“抢购处理超时”。

### 步骤3: 查看订单
1. 点击“我的订单”链接，跳转到 orders.html。
2. 系统加载订单列表（如果无订单，显示“暂无订单”）。
3. 点击“查看详情”：弹出模态，显示订单号、日期、票券编码、状态（待支付/已支付/已取消/已过期）、创建时间。
4. 如果状态为“待支付”且在24小时内，显示“取消订单”按钮。
5. 点击取消：确认后调用后端，成功刷新列表。

## 订单管理（orders.html）
- **列表视图**：显示订单号、日期、状态（友好文本，如“待支付”）。
- **详情模态**：完整订单信息。
- **取消逻辑**：仅限待支付订单，调用 /v1/cancel 接口（参数: userId, orderNo, ticketCode）。
- **刷新**：取消后自动重新加载列表。

## 常见问题与注意事项
- **加载卡住**：检查浏览器控制台错误，确保后端服务运行于8081端口。
- **异步超时**：如果超过30秒，系统自动停止并提示检查订单。
- **规则**：
    - 每人每天限购1张，已购票券卡片变灰。
    - 票券保留24小时，过期不可用。
    - 不支持退换。
- **调试**：控制台日志记录接口切换、抢购过程（INFO/WARN/ERROR）。
- **管理员功能**：需后端权限，非匿名用户可用。

如果遇到问题，检查浏览器控制台或后端日志。享受抢购！
